Description: fix denial of service and possible code execution
Origin: vendor, backport of patch from Debian 4.6.2-4 package

Index: tcpdump-4.2.1/print-isoclns.c
===================================================================
--- tcpdump-4.2.1.orig/print-isoclns.c	2015-04-24 15:13:30.339728244 -0400
+++ tcpdump-4.2.1/print-isoclns.c	2015-04-24 15:13:30.335728222 -0400
@@ -1014,7 +1014,7 @@
 
 	if (li < sizeof(struct esis_header_t) + 2) {
             printf(" length indicator < min PDU size %d:", li);
-            while (--length != 0)
+            while (pptr < snapend)
                 printf("%02X", *pptr++);
             return;
 	}
@@ -2742,8 +2742,15 @@
 {
         u_int16_t calculated_checksum;
 
-        /* do not attempt to verify the checksum if it is zero */
-        if (!checksum) {
+        /* do not attempt to verify the checksum if it is zero,
+         * if the total length is nonsense,
+         * if the offset is nonsense,
+         * or the base pointer is not sane
+         */
+        if (!checksum
+            || length > snaplen
+            || checksum_offset > snaplen
+            || checksum_offset > length) {
                 printf("(unverified)");
         } else {
                 calculated_checksum = create_osi_cksum(pptr, checksum_offset, length);
