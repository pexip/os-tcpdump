From 1a4e86d0a273cc81b3236d9f8a5f47b586fec84c Mon Sep 17 00:00:00 2001
From: Michael Richardson <mcr@sandelman.ca>
Date: Mon, 9 Mar 2015 16:02:54 -0400
Subject: [PATCH 2/3] test case files for CVE-2015-2153,2154,2155 backport of
 patches from tcpdump 4.7 for CVE-2015-2153,2154,2155
 issues

---
 print-forces.c   |    6 +-

[jmb: backport pdatacnt_print changes to 4.2]

diff --git a/print-forces.c b/print-forces.c
index 438aa27..933ac88 100644
--- a/print-forces.c
+++ b/print-forces.c
@@ -282,9 +282,13 @@ pdatacnt_print(register const u_char * pptr, register u_int len,
 
 			chk_op_type(type, op_msk, ops->op_msk);
 
+			if (ops->print != NULL) {
-			rc = ops->print((const u_char *)pdtlv,
-					tll + pad + TLV_HDRL, op_msk,
-					indent + 2);
+				rc = ops->print((const u_char *)pdtlv,
+						tll + pad + TLV_HDRL, op_msk,
+						indent + 2);
+				if (rc == -1)
+					return rc;
+			}
 			len -= (TLV_HDRL + pad + tll);
 		} else {
 			printf("Invalid path data content type 0x%x len %d\n",
@@ -503,7 +507,9 @@ int otlv_print(const struct forces_tlv *otlv, u_int16_t op_msk _U_, int indent)
 
 	}
 
-	rc = ops->print(dp, tll, ops->op_msk, indent + 1);
+        if(ops->print) {
+          rc = ops->print(dp, tll, ops->op_msk, indent + 1);
+        }
 	return rc;
 
 trunc:
